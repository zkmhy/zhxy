<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.accp.mapper.ClazzMapper">
	<!-- <cache></cache> -->
	<resultMap type="com.accp.domain.Clazz" id="clazz">
		<result property="id" column="id" />
		<result property="name" column="name" />
		<result property="num" column="num" />
		<result property="people" column="people" />
		<association property="grade" column="gradeId" select="com.accp.mapper.GradeMapper.queryById" javaType="com.accp.domain.Grade"></association>
		<association property="teacher" javaType="com.accp.domain.People" column="teacherId" select="com.accp.mapper.PeopleMapper.queryById"></association>
		<association property="curr" javaType="com.accp.domain.Curriculum" column="currId" select="com.accp.mapper.CurriculumMapper.queryById"></association>
	</resultMap>
	<resultMap type="com.accp.domain.Clazz" id="clazzNum" extends="clazz">
		<result property="planNum" column="planNum" />
	</resultMap>
	<resultMap type="com.accp.domain.Clazz" extends="clazz" id="planClazz">
		<association property="plans" column="{date=date,id=id}" javaType="list" select="com.accp.mapper.PlanMapper.classPlan"></association>
	</resultMap>
	<select id="queryById" resultMap="clazz">
		select *
		from clazz
		where id=#{id}
	</select>
	<select id="allClazz" resultMap="clazz">
		select *
		from clazz		
	</select>
	<select id="findClazz" resultMap="clazzNum">
		select *,(select count(0) from plan where cid=clazz.id and `date` between date(#{begin}) and date(#{end}) and active=false and study=true) planNum
		from clazz
		where teacherId=#{teacher.id} and `start` <![CDATA[<]]> date(#{end})
		order by planNum
	</select>
	<select id="clazzPlan" resultMap="planClazz">
		select *,#{date} `date`
		from clazz
		where dissolve=false
		order by `begin`
	</select>
	<select id="isStudyByOnself" resultType="int">
		select count(*)
		from plan
		where cid=#{clazz.id} and `date` between #{begin} and #{end} and study=false
		group by `date`
		having count(*)=2
	</select>
</mapper>
